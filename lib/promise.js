/*!
 * ND-PROMISE v3.0.2
 * (c) 2016 crossjs
 * Released under the MIT License.
 */
"use strict";function NP(t){var e=this;if("object"!==_typeof(this))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=null,this._value=null,this._progress=null,this._deferreds=[],doResolve(t,function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];resolve.apply(e,n)},function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];reject.apply(e,n)},function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];notify.apply(e,n)})}function handle(t){var e=this;return null===this._state?(this._deferreds.push(t),void(t.onProgress&&null!==this._progress&&setImmediate(function(){t.onProgress(e._progress)}))):void setImmediate(function(){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return void(e._state?t.resolve:t.reject)(e._value);var r=void 0;try{r=n(e._value)}catch(e){return void t.reject(e)}t.resolve(r)})}function resolve(t){var e=this;try{if(t===this)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"===("undefined"==typeof t?"undefined":_typeof(t))||"function"==typeof t)){var n=function(){var n=t.then;if("function"==typeof n)return doResolve(function(){for(var e=arguments.length,r=Array(e),o=0;o<e;o++)r[o]=arguments[o];n.apply(t,r)},function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];resolve.apply(e,n)},function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];reject.apply(e,n)},function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];notify.apply(e,n)}),{v:void 0}}();if("object"===("undefined"==typeof n?"undefined":_typeof(n)))return n.v}this._state=!0,this._value=t,finale.call(this)}catch(t){reject.call(this,t)}}function reject(t){this._state=!1,this._value=t,finale.call(this)}function notify(t){this._progress=t,finale.call(this,!0)}function finale(t){for(var e=0,n=this._deferreds.length;e<n;e++)handle.call(this,this._deferreds[e]);t||(this._deferreds=null)}function Handler(t,e,n,r,o,i){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.onProgress="function"==typeof n?n:null,this.resolve=r,this.reject=o,this.notify=i}function doResolve(t,e,n,r){var o=!1;try{t(function(t){o||(o=!0,e(t))},function(t){o||(o=!0,n(t))},function(t){o||r(t)})}catch(t){if(o)return;o=!0,n(t)}}var setimmediate=require("setimmediate"),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};NP.prototype.catch=function(t){return this.then(null,t)},NP.prototype.finally=function(t){return this.then(function(e){return NP.resolve(t()).then(function(){return e})},function(e){return NP.resolve(t()).then(function(){throw e})})},NP.prototype.progress=function(t){return this.then(null,null,t)},NP.prototype.then=function(t,e,n){var r=this;return new NP(function(o,i,f){handle.call(r,new Handler(t,e,n,o,i,f))})},NP.resolve=function(t){return t&&"object"===("undefined"==typeof t?"undefined":_typeof(t))&&t.constructor===NP?t:new NP(function(e){return e(t)})},NP.reject=function(t){return new NP(function(e,n){return n(t)})},NP.notify=function(t){return new NP(function(e,n,r){return r(t)})},NP.all=function(t){return new NP(function(e,n,r){function o(f,u){try{if(u&&("object"===("undefined"==typeof u?"undefined":_typeof(u))||"function"==typeof u)){var l=u.then;if("function"==typeof l)return void l.call(u,function(t){o(f,t)},n,r)}t[f]=u,0===--i&&e(t)}catch(t){n(t)}}if(0===t.length)return e([]);for(var i=t.length,f=0;f<t.length;f++)o(f,t[f])})},NP.race=function(t){return new NP(function(e,n,r){for(var o=0,i=t.length;o<i;o++)NP.resolve(t[o]).then(e,n,r)})},module.exports=NP;